#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ü™ù Running pre-push hook: Generating changelogs..."
npm run changelog

if [ $? -ne 0 ]; then
  echo "‚ùå Changelog generation failed. Aborting push."
  exit 1
fi

CHANGELOG_FILES="public/changelog.json public/changelog-backend.json public/changelog-combined.json"

EXISTING_FILES=""
for file in $CHANGELOG_FILES; do
  if [ -f "$file" ]; then
    EXISTING_FILES="$EXISTING_FILES $file"
  fi
done

if [ -n "$EXISTING_FILES" ]; then
  echo "üìÑ Checking for changelog updates..."
  git add $EXISTING_FILES
  if ! git diff --cached --quiet; then
    echo "‚úÖ Changelogs updated ‚Äî committing changes..."
    git commit --amend --no-edit || git commit -m "chore: add generated changelogs"
  else
    echo "‚ÑπÔ∏è No changelog changes detected."
  fi
else
  echo "‚ö†Ô∏è No changelog files found even after generation. Skipping commit."
fi
